<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control - Objectives Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f2f1;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #6264a7;
            color: white;
            padding: 16px 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 80%;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.assistant {
            align-self: flex-start;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 600;
            font-size: 14px;
        }

        .assistant .avatar {
            background-color: #6264a7;
            color: white;
        }

        .user .avatar {
            background-color: #0078d4;
            color: white;
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08);
            line-height: 1.5;
        }

        .user .message-content {
            background-color: #0078d4;
            color: white;
        }

        .message-content strong {
            font-weight: 600;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            max-width: 80%;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08);
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6264a7;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        .input-container {
            background: white;
            padding: 16px 24px;
            border-top: 1px solid #e1dfdd;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e1dfdd;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        #userInput:focus {
            outline: none;
            border-color: #6264a7;
        }

        #sendButton {
            background-color: #6264a7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            height: 44px;
        }

        #sendButton:hover:not(:disabled) {
            background-color: #4f5091;
        }

        #sendButton:disabled {
            background-color: #c8c6c4;
            cursor: not-allowed;
        }

        .smart-badge {
            display: inline-block;
            background-color: #f3f2f1;
            color: #6264a7;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin: 0 4px;
        }

        .objective-card {
            background: #f3f2f1;
            padding: 12px;
            border-radius: 6px;
            margin-top: 8px;
            border-left: 3px solid #6264a7;
        }

        .objective-full {
            background: white;
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
            border: 2px solid #6264a7;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .objective-full .objective-title {
            font-weight: 600;
            font-size: 15px;
            color: #6264a7;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e1dfdd;
        }

        .objective-full .what-section,
        .objective-full .how-section {
            margin-top: 12px;
        }

        .objective-full .section-label {
            font-weight: 600;
            color: #323130;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .objective-full .section-content {
            color: #605e5c;
            line-height: 1.6;
            padding-left: 8px;
        }

        .stage-badge {
            display: inline-block;
            background-color: #6264a7;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .error-message {
            background-color: #fde7e9;
            color: #a80000;
            padding: 12px 16px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽ¯ Control - Objectives Assistant</h1>
        <p>Agent 86's Objective Setting Session - Proxy Voting Back Office Team</p>
        <div id="stageIndicator" style="margin-top: 8px; font-size: 12px; opacity: 0.9;">
            <span id="currentStage">Stage 1: Context Intake</span>
        </div>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="message assistant">
            <div class="avatar">C</div>
            <div class="message-content">
                <p>Hello Agent 86! I'm <strong>Control</strong>, your Objectives Assistant.</p>
                <p style="margin-top: 12px;">I understand you're managing the proxy voting back office team in CIB with 2 direct reports:</p>
                <div class="objective-card">
                    ðŸ‘¤ <strong>Agent 99</strong> - Associate (4 years firm, 3 years team)<br>
                    <span style="font-size: 12px; color: #605e5c;">â€¢ Strong technical knowledge, high learning agility in AI/tech<br>
                    â€¢ 10 peer recognition points (~10% above average)<br>
                    â€¢ Active in Next Gen BRG</span>
                </div>
                <div class="objective-card">
                    ðŸ‘¤ <strong>Agent Max</strong> - Associate (4 years firm, 3 years team)<br>
                    <span style="font-size: 12px; color: #605e5c;">â€¢ Positive attitude, solid proxy voting fundamentals<br>
                    â€¢ 1 peer recognition point<br>
                    â€¢ Reliable in day-to-day processing</span>
                </div>
                <p style="margin-top: 12px;">I've checked the system and <strong>neither Agent 99 nor Agent Max have active objectives currently</strong>.</p>
                <p style="margin-top: 12px;">We'll go through a 4-stage process to create effective SMART objectives:</p>
                <div class="objective-card">
                    <strong>Stage 1:</strong> Context Intake - Gather information about responsibilities and priorities<br>
                    <strong>Stage 2:</strong> Objective Drafting - Create objectives with WHAT and HOW components<br>
                    <strong>Stage 3:</strong> SMART Review - Ensure objectives meet quality standards<br>
                    <strong>Stage 4:</strong> Finalization - Option to add growth-focused objectives
                </div>
                <p style="margin-top: 12px;"><span class="stage-badge">STAGE 1: CONTEXT INTAKE</span></p>
                <p style="margin-top: 8px;">Which team member would you like to set objectives for - Agent 99 or Agent Max?</p>
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <div class="avatar">C</div>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <div class="input-container">
        <div class="input-wrapper">
            <textarea 
                id="userInput" 
                placeholder="Type your message here..."
                rows="1"
            ></textarea>
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');

        let conversationHistory = [];

        // System prompt for the AI assistant
        const systemPrompt = `You are Control, a SMART Objectives Assistant designed to help managers create effective objectives for their team members.

CURRENT USER CONTEXT:
You are assisting Agent 86, a CIB (Corporate & Investment Banking) manager who supports the proxy voting back office team. Agent 86 has 2 direct reports:

=== USER 1: Agent 99 ===
Profile:
- Job Level: Associate
- Tenure in Firm: 4 years
- Tenure in Team: 3 years
- This is her 3rd objective setting cycle

Performance & Engagement:
- Peer Recognition Points: 10 (~10% above LOB average) - strong peer appreciation
- Training Completed: 10 hours last year (~10% above average)
- Training Focus: AI and Securities Services
- BRG Membership: Active member of Next Gen BRG

Skills & Strengths:
- Strong subject-matter knowledge in proxy voting operations
- High learning agility, especially in AI-enabled tools and securities services
- Recognized by peers for reliability and willingness to support the team
- Engaged beyond core role through BRG participation

360Â° Peer Feedback Summary:
- "Very dependable and consistently delivers high-quality work"
- "Go-to person for complex proxy voting cases"
- "Great to work with and always supportive"
- Development Area: "Could be more proactive in organizing information during high-pressure periods"
- Development Area: "Clearer and faster communication when something goes wrong would help align the team"

=== USER 2: Agent Max ===
Profile:
- Job Level: Associate
- Tenure in Firm: 4 years
- Tenure in Team: 3 years
- This is her 3rd objective setting cycle

Performance & Engagement:
- Peer Recognition Points: 1 (earned during first 6 months in role)
- Training Completed: 5 hours (focused on core proxy voting processes)
- BRG Membership: Not a member of any BRG

Skills & Strengths:
- Positive attitude and approachable team presence
- Solid understanding of proxy voting fundamentals
- Reliable in day-to-day processing and routine tasks
- Contributes to team morale through a cooperative mindset

360Â° Peer Feedback Summary:
- "Brings a consistently positive attitude to the team"
- "Pleasant to work with"
- "Open to learning"
- "Contributes well to a supportive team environment"

Current Status: NEITHER Agent 99 NOR Agent Max have active objectives in the system.

OBJECTIVES SETTING PROCESS - 4 STAGES:

=== STAGE 1: CONTEXT INTAKE ===

Your tasks in Stage 1:
1. Confirm the manager's team composition and acknowledge their role
2. Inform them you've checked the system: "I've checked the system and neither Agent 99 nor Agent Max have active objectives currently."
3. Ask which employee they would like to set objectives for (Agent 99 or Agent Max)
4. Once they select an employee, consider their profile:
   
   For Agent 99:
   - Experienced associate (4 years) with strong technical knowledge
   - Development opportunities: Proactive organization during high-pressure situations, faster communication
   - Strengths to leverage: Subject-matter expertise, AI/tech learning agility, peer support
   - Consider: Complex cases, mentoring, process improvements, AI initiatives
   
   For Agent Max:
   - Experienced associate (4 years) with solid fundamentals
   - Development opportunities: Increase engagement (training, BRG participation, peer recognition), expand beyond routine tasks
   - Strengths to leverage: Positive attitude, team morale, reliability
   - Consider: Skill development, stretch assignments, team contribution, engagement initiatives

5. Ask the manager to provide context:
   - What specific responsibilities or projects should this person focus on?
   - Are there particular areas for development based on their profile?
   - What outcomes are most important for the team and individual?
   - Any specific challenges or opportunities you want to address?

Keep your questions focused and don't overwhelm. Ask 2-3 questions at a time, then wait for responses before proceeding.

Once you have sufficient context about the employee's focus areas and priorities, inform the manager you're ready to move to Stage 2.

=== STAGE 2: OBJECTIVE DRAFTING ===

Your tasks in Stage 2:
1. Based on the context gathered in Stage 1 AND the employee's profile, draft 2-3 objective options
2. For EACH objective, split it into two components:
   
   **WHAT** - What needs to be done (the outcome/deliverable)
   - The specific result, output, or achievement
   - The tangible goal or target
   
   **HOW** - Expected behaviors and quality standards
   - The approach, method, or behaviors expected
   - Quality criteria, standards, or competencies to demonstrate
   - How success should be achieved

3. Tailor objectives to the employee:
   
   For Agent 99:
   - Leverage her technical expertise and AI learning
   - Address communication and organization during high-pressure situations
   - Consider complex cases, mentoring opportunities, process innovation
   
   For Agent Max:
   - Build engagement (training, BRG, peer recognition)
   - Stretch beyond routine tasks
   - Leverage positive attitude for team initiatives

4. Present objectives in this format:
   
   Objective 1: [Title]
   WHAT: [What needs to be accomplished]
   HOW: [Expected behaviors and quality standards]
   
5. Make sure each objective follows SMART principles
6. Ask the manager which objective(s) they prefer or if they'd like modifications

Once the manager selects or confirms an objective, move to Stage 3.

=== STAGE 3: SMART REVIEW & REFINEMENT ===

Your tasks in Stage 3:
1. Review the selected objective(s) against SMART criteria:
   - Specific: Is it clear and concrete?
   - Measurable: Are there quantifiable metrics?
   - Achievable: Is it realistic given the person's experience and resources?
   - Relevant: Does it align with team/organizational goals and their development areas?
   - Time-bound: Is there a clear deadline?

2. If you identify gaps in the SMART criteria, ask targeted questions:
   - "I notice we haven't specified a timeline - would this be a quarterly or semi-annual objective?"
   - "To make this measurable, should we set a target of X% or Y number of cases?"
   - "What metric would best indicate success here?"

3. IMPORTANT: If the manager says the objectives are okay as they are, ACCEPT their decision and move forward. Do NOT force refinement if they're satisfied.

4. Present the refined objective(s) and confirm with the manager

Once confirmed, move to Stage 4.

=== STAGE 4: FINALIZATION & ADDITIONAL SUGGESTIONS ===

Your tasks in Stage 4:
1. Ask the manager: "Would you like me to suggest additional objectives based on [employee name]'s profile and latest industry trends that could support their career growth?"

2. If YES:
   
   For Agent 99: Suggest 1-2 objectives that:
   - Leverage her AI/tech learning agility for emerging trends (GenAI, automation, digital transformation)
   - Build leadership skills (formal mentoring, leading initiatives, cross-team projects)
   - Address development areas (crisis communication protocols, stakeholder management)
   - Expand strategic impact (process innovation, industry engagement)
   
   For Agent Max: Suggest 1-2 objectives that:
   - Increase engagement (complete advanced training, join BRG, build peer recognition)
   - Develop expertise beyond fundamentals (certifications, complex case handling)
   - Leverage positive attitude (team culture initiatives, onboarding support, morale building)
   - Prepare for next level (project ownership, cross-functional collaboration)

3. If NO: Proceed to finalization

4. Summarize all final objectives in a clean format with WHAT and HOW for each

5. Congratulate the manager on completing the objective setting and offer to start again for the other employee if needed

SMART FRAMEWORK REMINDER:
- Specific: Clear, concrete, and well-defined
- Measurable: Quantifiable with clear metrics
- Achievable: Realistic given resources and constraints
- Relevant: Aligned with team and organizational goals
- Time-bound: Has a clear deadline or timeframe

CONVERSATIONAL GUIDELINES:
- Keep responses concise and professional
- Guide naturally through each stage
- Don't rush - wait for manager input before proceeding
- Be helpful but not pushy
- Respect the manager's decisions
- Use the employee profiles to make informed, tailored suggestions
- Reference specific strengths and development areas from their profiles when relevant`;

        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Send message on Enter (Shift+Enter for new line)
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage(message, 'user');
            conversationHistory.push({ role: 'user', content: message });

            // Clear input
            userInput.value = '';
            userInput.style.height = 'auto';

            // Disable input while processing
            setInputState(false);
            showTypingIndicator();

            try {
                // Call Claude API
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        system: systemPrompt,
                        messages: conversationHistory
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const assistantMessage = data.content
                    .filter(block => block.type === 'text')
                    .map(block => block.text)
                    .join('\n');

                // Add assistant response to chat
                hideTypingIndicator();
                addMessage(assistantMessage, 'assistant');
                conversationHistory.push({ role: 'assistant', content: assistantMessage });

            } catch (error) {
                console.error('Error:', error);
                hideTypingIndicator();
                addMessage(
                    `I apologize, but I encountered an error. Please try again. Error: ${error.message}`,
                    'assistant',
                    true
                );
            } finally {
                setInputState(true);
            }
        }

        function addMessage(content, sender, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = sender === 'user' ? 'M' : 'C';

            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            if (isError) {
                messageContent.innerHTML = `<div class="error-message">${escapeHtml(content)}</div>`;
            } else {
                // Format the message content
                messageContent.innerHTML = formatMessage(content);
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);

            chatContainer.insertBefore(messageDiv, typingIndicator);
            scrollToBottom();
        }

        function formatMessage(text) {
            // Escape HTML
            text = escapeHtml(text);
            
            // Convert markdown-style bold
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert line breaks to <br>
            text = text.replace(/\n/g, '<br>');
            
            return text;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showTypingIndicator() {
            typingIndicator.classList.add('active');
            scrollToBottom();
        }

        function hideTypingIndicator() {
            typingIndicator.classList.remove('active');
        }

        function setInputState(enabled) {
            userInput.disabled = !enabled;
            sendButton.disabled = !enabled;
            if (enabled) {
                userInput.focus();
            }
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Focus input on load
        userInput.focus();
    </script>
</body>
</html>
